<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="../../static/img/header/l.png" />
  <link rel="stylesheet" href="../../static/css/style.min.css?_v=20220413192659" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css?_v=20220610025949" />

  </head>

  <body>
    <div class="wrapper">
      <header class="header">
  <div class="header__container">
    <div class="icon-menu">
      <span></span>
      <span></span>
      <span></span>
    </div>
    <a href="index.html" class="header__logo"><img src="../../static/img/header/Logo.svg" alt="Logo" /></a>
    <div class="header__menu menu">
      <nav class="menu__body">
        <ul class="menu__list">
          <li><a href="index.html" class="menu__link">HOME</a></li>
          <li><a href="medicine-catalog.html" class="menu__link">Medications</a></li>
          <li><a href="pills-body.html" class="menu__link">Order</a></li>
          <li><a href="about-us.html" class="menu__link">ABOUT US</a></li>
          <li><a href="BlogPart2.html" class="menu__link">BLOG</a></li>
        </ul>
      </nav>
    </div>
    <div class="header__actions actions-header">

      <div class="actions-header__user user-header">
        <div class="user-header__icon">
          <img src="../../static/img/header/user.svg" alt="" />
        </div>

        <ul class="user-header__menu">
          <li><a href="profile.html" class="user-header__link user-header__link_1">Profile</a></li>
          <li><a href="profile.html" class="user-header__link user-header__link_2">Orders</a></li>
          <li><a href="" id="logout" class="user-header__link user-header__link_3">Exit</a></li>
        </ul>
      </div>
    </div>
  </div>
</header>
      <main class="main">
        <section class="pills-body">
          <div class="pills-body__container">
            <div class="pills-body__notice-block">
              <h3 class="notice-block__title">Please select the location where you feel pain and choose type of order</h3>
              <div class="notice-block__text">
                On the left, you can select a medicine or a symptom, when choosing a medicine, you will need to select a symptom and
                select pill based on it. First, select the part of the body that hurts in the picture. The entire catalog of medicines
                with a description can be viewed on the page medications.
              </div>
            </div>
            <div class="pills-body__content">
              <div class="pills-body__choose-block">
                <div class="switch-button">
                  <button class="medicines-switch" onclick="switchMedicines()">Medicines</button>
                  <button class="symptoms-switch on" onclick="switchSymptoms()">Symptoms</button>
                </div>
                <div class="human-body">
                  <div class="human-body__image">
                    <picture
                    ><source srcset="../../static/img/medications-body/human-body.webp" type="image/webp" />
                      <img src="../../static/img/medications-body/human-body.webp" alt=""
                      /></picture>
                  </div>
                  <a href="#" class="human-body__button human-body__button_1 open-popup"> </a>
                  <a href="#" class="human-body__button human-body__button_2 open-popup"> </a>
                  <a href="#" class="human-body__button human-body__button_3 open-popup"> </a>
                  <a href="#" class="human-body__button human-body__button_4 open-popup"> </a>
                </div>
              </div>
              <div class="popup" hidden="true">
                <div class="popup__body">
                  <div class="popup__content">
                    <a href="" class="close-popup"></a>
                    <div class="popup__title">Head</div>
                    <div class="popup-symptoms"></div>
                    <div class="popup-medicines" hidden="true">
                      <div class="popup-medicines__symptoms">

                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
        <section class="basket">
          <div class="basket__container">
            <div class="basket__content-container">
              <div class="basket__content">
                <div class="basket__shopping">
                  <div class="shopping__title">Shopping cart</div>
                  <div class="shopping__goods">
                    <div class="med-basket" hidden="true">
                      <ul class="goods__grid">

                      </ul>
                    </div>
                    <div class="symptoms-basket">
                      <ul class="goods__grid symptoms-grid">

                      </ul>
                    </div>
                  </div>
                </div>
                <div class="basket__Bdetails">
                  <div class="Bdetails__title">You order</div>
                  <div class="Bdetails__delivery" hidden="true">
                    <label for="delivery" class="delivery__title">Delivery:</label>
                    <select class="delivery__text" name="delivery" id="delivery">
                      <option class="delivery__text" value="Red-cantin">Red-cantin</option>
                    </select>
                  </div>
                  <div class="Bdetails__ID">
                    <div class="ID__title">ID:</div>
                    <div class="ID__idText"></div>
                  </div>
                  <div class="Bdetails__comments">
                    <label class="comments__title">Comments:</label>
                    <textarea class="comments__input" name="comments" id="" cols="30" rows="30" placeholder="Your comments"></textarea>
                  </div>
                </div>
                <button type="button" class="Bdetails__button" onclick="addOrder(event)">Order</button>
              </div>
            </div>
          </div>
        </section>

      </main>
      <footer class="footer">
  <div class="footer__container">
    <div class="footer_row">
      <div class="footer__column">
        <div class="footer__logo">
          <img src="../../static/img/footer/footer-logo.svg" alt="footer-logo" />
        </div>
      </div>
      <div class="footer__column">
        <div class="footer__label">Features</div>
        <nav class="footer__menu menu-footer">
          <ul class="menu-footer__list">
            <li class="menu-footer__item">
              <a href="about-us.html" class="menu-footer__link">About us</a>
            </li>
            <li class="menu-footer__item">
              <a href="BlogPart2.html" class="menu-footer__link">Blog</a>
            </li>
            <li class="menu-footer__item">
              <a href="pills-body.html" class="menu-footer__link">Orders</a>
            </li>
            <li class="menu-footer__item">
              <a href="medicine-catalog.html" class="menu-footer__link">Medications</a>
            </li>
          </ul>
        </nav>
      </div>
      <div class="footer__column">
        <div class="footer__label">Get In Touch</div>
        <div class="footer__contacts contacts-footer">
          <a
            href="tel:87756574105"
            class="contacts-footer__item contacts-footer__item_phone"
            >8(775)-6574-105</a
          >
          <a href="" class="contacts-footer__item contacts-footer__item_map">
            Абылай хана 1/1</a
          >
          <a
            href="mailto:info@sdu.edu.kz"
            class="contacts-footer__item contacts-footer__item_email"
            >info@sdu.edu.kz</a
          >
        </div>
      </div>
    </div>
  </div>
</footer>

    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js?_v=20220413192659"></script>
    <script src="../../static/js/home.min.js"></script>
    <script src="../../static/js/catalog.min.js"></script>

<!--    <script>-->
<!--      if (window.localStorage.getItem('sdu_id') == null) {-->
<!--        window.location.href = 'Login.html';-->
<!--      }-->

<!--      let logoutButton = document.getElementById("logout")-->
<!--      logoutButton.addEventListener("click", function() {-->
<!--        window.localStorage.clear()-->
<!--        location.reload()-->
<!--      });-->
<!--    </script>-->
    <script>
      function switchMedicines() {
        document.querySelector(".symptoms-switch").classList.remove("on");
        document.querySelector(".medicines-switch").classList.add("on");
        document.querySelector(".popup-medicines").hidden = false;
        document.querySelector(".popup-symptoms").hidden = true;
        document.querySelector(".popup").style.flex = "0 1 60%";
        document.querySelector(".symptoms-basket").hidden = true;
        document.querySelector(".med-basket").hidden = false;
        document.querySelector(".Bdetails__delivery").hidden = false;

      }
      function switchSymptoms() {
        document.querySelector(".medicines-switch").classList.remove("on");
        document.querySelector(".symptoms-switch").classList.add("on");
        document.querySelector(".popup-medicines").hidden = true;
        document.querySelector(".popup-symptoms").hidden = false;
        document.querySelector(".popup").style.flex = "0 1 50%";
        document.querySelector(".symptoms-basket").hidden = false;
        document.querySelector(".med-basket").hidden = true;
        document.querySelector(".Bdetails__delivery").hidden = true;
      }



      const popup = document.querySelector(".popup");
      const openPopupButtons = document.querySelectorAll(".open-popup");
      const closePopupButton = document.querySelector(".close-popup");

      openPopupButtons.forEach((button) => {
        button.addEventListener("click", (e) => {
          e.preventDefault();
          popup.classList.toggle("active-popup");
          popup.hidden = false;
        });
      });
      closePopupButton.addEventListener("click", (e) => {
        e.preventDefault();
        popup.classList.remove("active-popup");
        popup.hidden = true;
      });
    </script>
    <script>
      const api_url = 'https://backend.sulaksi.kz/api/pill/body-part/';

      async function initPillBody(body){
        document.querySelector(".ID__idText").innerText = window.localStorage.getItem('sdu_id');
        document.addEventListener("click", function (event) {
          if (event.target.classList.contains("popup-accordion")){
            const a=event.target;
              a.classList.toggle("active-accordion");
              let panel = a.nextElementSibling;
              if (panel.style.display == "none") {
                panel.style.display = "block";
              } else {
                panel.style.display = "none";
              }
          }
          if (event.target.classList.contains("human-body__button_1")){
            let item1 = body.find(i => i.id === 1);
            mainSymptoms(item1);
            mainMedicines(item1)
          }
          if (event.target.classList.contains("human-body__button_2")){
            let item1 = body.find(i => i.id === 2);
            mainSymptoms(item1);
            mainMedicines(item1)
          }
          if (event.target.classList.contains("human-body__button_3")){
            let item1 = body.find(i => i.id === 3);
            mainSymptoms(item1);
            mainMedicines(item1)
          }
          if (event.target.classList.contains("human-body__button_4")){
            let item1 = body.find(i => i.id === 4);
            mainSymptoms(item1);
            mainMedicines(item1)
          }

        })
      }
      function mainSymptoms(item){
        document.querySelector(".popup__title").innerText = item.title;
        document.querySelector(".popup-symptoms").innerHTML = `${item.simptoms.map(addSymptoms).join('')}`;
      }

      function addSymptoms(symptom){
        return `<div class="popup-symptoms__symptom">
                        <div class="symptom__name" data-id="${symptom.id}">${symptom.title}</div>
                        <div class="symptom__add ${searchS(symptom.id)}"></div>
                      </div>`;
      }
      function searchS(id){
        const symptomsWrapper = document.querySelector(".symptoms-grid");
        if(symptomsWrapper.querySelector(`[data-id="${id}"]`)){
          return `add-minus`
        }
      }
      function mainMedicines(item){
        document.querySelector(".popup-medicines__symptoms").innerHTML = `${item.simptoms.map(addMedS).join('')}`;
      }
      function addMedS(symptom){
        return `<div class="popup-medicines__symptom">
                          <button class="popup-accordion" data-id="${symptom.id}">${symptom.title}</button>
                          <div class="popup-accordion__panel">
                          ${symptom.pills.map(addMedP).join('')}
                          </div>
                        </div>`;
      }
      function addMedP(pill){
        return `<div class="panel__popup-medicine" data-id="${pill.id}">
                              <div class="popup-medicine__img" style="background-image: url(${pill.photo})"></div>
                              <div class="popup-medicine__medicine-info">
                                <div class="medicine-info__name">${pill.title}</div>
                                <div class="medicine-info__cure">The cure for:</div>
                                <div class="medicine-info__cure-for">
                                ${pill.description}
                                </div>
                              </div>
                              <div class="popup-medicine__basket-adding">
                                <div class="basket-adding__counter counter-wrapper">
                                  <div class="counter__control" data-action="minus"></div>
                                  <div class="counter__curerent" data-counter>1</div>
                                  <div class="counter__control" data-action="plus"></div>
                                </div>
                                <button class="medicine-button" type="button" data-cart>Add</button>
                              </div>
                            </div>`
      }






      async function getPillBody() {
        const response = await fetch(api_url, {
          headers: {
            'Authorization': "Bearer " + window.localStorage.getItem('token')
          },
        })
        const data = await response.json();

        if (response.status === 200) {

          await initPillBody(data);
        } else {

          alert('Error message: ' + "Incorrect data");
        }
      }

      getPillBody();
    </script>
  <script>





    async function addOrder() {
      if (document.querySelector(".symptoms-switch").classList.contains("on")) {
        let symptomsWrapper = document.querySelector(".symptoms-grid");
        let symptomsa = symptomsWrapper.getElementsByClassName("grid__good");

        if (!(symptomsa.length == '0')) {
          let PostSymptoms = new Array(symptomsa.length);
          for (let i = 0; i < PostSymptoms.length; i++) {
            PostSymptoms[i] = {"simptom": symptomsa[i].dataset.id};
          }
          const comment = document.querySelector(".comments__input").value;
          const response = await fetch('https://backend.sulaksi.kz/api/order/s-order/', {
            method: 'POST',
            body: JSON.stringify(
                    {
                      order_type: "simptom",
                      description: comment,
                      pills: [],
                      simptoms: PostSymptoms,
                    }
            ),

            headers: {
              'Authorization': "Bearer " + window.localStorage.getItem('token'),
              'Content-Type': 'application/json'
            },

          })
          window.location.replace("success.html");
        } else {

          window.location.replace("empty.html");


        }
      }



      else if(document.querySelector(".medicines-switch").classList.contains("on")) {
        let medicineWrapper = document.querySelector(".med-basket");
        let medGrid = medicineWrapper.querySelector(".goods__grid");
        let medicine = medGrid.getElementsByClassName("grid__good");

        if (!(medicine.length=='0')) {
          let PostMedicine = new Array(medicine.length);
          for (let i = 0; i < PostMedicine.length; i++) {
            PostMedicine[i] = {"pill": medicine[i].dataset.id,"count":medicine[i].querySelector("[data-counter]").innerText};
          }
          const comment= document.querySelector(".comments__input").value;
          const response = await fetch('https://backend.sulaksi.kz/api/order/s-order/', {
            method: 'POST',
            body: JSON.stringify(
                    {
                      order_type: "pill",
                      description: comment,
                      pills:PostMedicine,
                      simptoms: [],
                    }
            ),

            headers: {
              'Authorization': "Bearer " + window.localStorage.getItem('token'),
              'Content-Type': 'application/json'
            },

          })
          window.location.replace("success.html");
        }
        else{
          window.location.replace("empty.html");
        }



      }
    }





  </script>
  </body>
</html>
